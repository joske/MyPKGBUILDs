#!/bin/sh
build() {
  add_runscript

  local d f rel out

  # Need zstd in the initcpio *build* environment (not inside initramfs)
  if ! command -v zstd >/dev/null 2>&1; then
    error "x1e-firmware: zstd not found (install zstd package)"
    return 1
  fi

  for d in /usr/lib/firmware/qcom /usr/lib/firmware/ath12k; do
    [[ -d "$d" ]] || continue

    while IFS= read -r -d '' f; do
        add_file "$f"
    done < <(find "$d" -type f -print0)
  done
}

help() {
  cat <<'EOF'
Adds qcom/ and ath12k/ firmware into initramfs, decompressing *.zst.
EOF
}
